import { useDispatch, useSelector } from "react-redux";
import { useNavigate, useParams } from "react-router-dom";
import Title from "../components/Title";
import style from "./Detail.module.css";
import { boardActions } from "../store/boardSlice";
import { useEffect } from "react";

const Detail = () => {


  const params = useParams();
  const dispatch = useDispatch();
  const boardList = useSelector((state) => {
    return state.board.board;
  });

  const detailItem = boardList.filter((item) => item.key === params.id);
  const reMoveItem = boardList.filter((item) => item.key !== params.id);

  const navigation = useNavigate();

  console.log(detailItem);

  const ovRemoveHandler = (key) => {
    const id = String(key);

    const removeFetch = async () => {
      await fetch(
        `https://react-spa-board-default-rtdb.firebaseio.com/boarditem/${id}.json`,
        {
          method: "DELETE",
        }
      );
      dispatch(boardActions.removerItem(reMoveItem));
      navigation("/");
    };
    (async () => {
      try {
        await removeFetch();
      } catch (error) {
        console.log(error);
      }
    })();
  };

  return (
    <>
      <Title title={"Detail페이지"} />

      <header className={style.title}>
        <h2>{detailItem[0].title}</h2>
      </header>
      <div className={style.item}>
        <div className={style.items}>작성자: "{detailItem[0].author}"</div>
        <div className={style.items}>작성일: "{detailItem[0].created}"</div>
      </div>
      <main className={style.content}>
        <p className={style.contents}>{detailItem[0].contents}</p>
      </main>
      <footer className={style.btn}>
        <button
          onClick={() => {
            navigation(-1);
          }}
        >
          홈으로
        </button>
        <button
          onClick={() => {
            navigation(`/edititem/${detailItem[0].key}`);
          }}
        >
          수정
        </button>
        <button onClick={() => ovRemoveHandler(detailItem[0].key)}>삭제</button>
      </footer>
    </>
  );
};

export default Detail;
